<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Convertidor CLP a USD y ARS</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,100..1000;1,100..1000&display=swap" rel="stylesheet" />

    <style>
      body {
        background-image: url("https://wallpapercat.com/w/full/c/3/4/718406-1284x2778-mobile-hd-santiago-chile-background.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        font-family: "DM Sans", sans-serif;
        height: 100dvh !important;
      }
      .glass {
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px); /* Safari */
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.2), -8px -8px 20px rgba(255, 255, 255, 0.1);
        border-radius: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4">
    <div class="glass p-6 md:p-8 max-w-md w-full space-y-6">
      <h1 class="text-3xl font-bold text-center text-white drop-shadow-md flex items-center justify-center gap-2">
        <img src="https://flagcdn.com/cl.svg" alt="Chile" class="w-8 h-6 rounded shadow-md" />
        Convertidor de CLP
      </h1>

      <div id="updateTime" class="text-sm text-white text-center italic">Última actualización: -</div>

      <div>
        <label for="clpAmount" class="block text-white font-semibold mb-2">Monto en Pesos Chilenos (CLP):</label>
        <input
          type="text"
          inputmode="decimal"
          id="clpAmount"
          class="w-full px-4 py-3 border border-white border-opacity-30 rounded-xl bg-white/20 text-white shadow-inner backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-gray-500 text-lg placeholder-white placeholder-opacity-60"
          placeholder="Ej: 10.000,00"
        />
      </div>

      <div id="results" class="space-y-4">
        <div class="flex items-center justify-between px-4 py-3 rounded-xl shadow-xl bg-white/10 backdrop-blur-md border border-white/20">
          <div class="flex items-center gap-2">
            <img src="https://flagcdn.com/us.svg" alt="USA" class="w-6 h-4 rounded shadow-md" />
            <span class="text-white">USD</span>
          </div>
          <span id="usdResult" class="text-xl font-light text-white">-</span>
        </div>

        <div class="flex items-center justify-between px-4 py-3 rounded-xl shadow-xl bg-white/10 backdrop-blur-md border border-white/20">
          <div class="flex items-center gap-2">
            <img src="https://flagcdn.com/ar.svg" alt="Argentina" class="w-6 h-4 rounded shadow-md" />
            <span class="text-white">ARS</span>
          </div>
          <span id="arsResult" class="text-xl font-light text-white">-</span>
        </div>
      </div>
    </div>
    <script>
      const apiKey = "80886aa4ca1b1db7436dbadb";
      const clpAmountInput = document.getElementById("clpAmount");
      const usdResult = document.getElementById("usdResult");
      const arsResult = document.getElementById("arsResult");
      const updateTime = document.getElementById("updateTime");
      let rates = null;
      let rawValue = "";

      const formatter = new Intl.NumberFormat("es-CL", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });

      clpAmountInput.addEventListener("input", (e) => {
        // Guarda el valor limpio sin puntos ni comas
        rawValue = e.target.value.replace(/\./g, "").replace(/,/g, ".");
        const amount = parseFloat(rawValue);

        if (!rates || isNaN(amount) || amount <= 0) {
          usdResult.textContent = "-";
          arsResult.textContent = "-";
          return;
        }

        // Mostrar resultados actualizados mientras escribe
        usdResult.textContent = "U$D" + formatter.format(amount * rates.USD);
        arsResult.textContent = "$" + formatter.format(amount * rates.ARS);
      });

      clpAmountInput.addEventListener("blur", () => {
        const amount = parseFloat(rawValue);
        if (!isNaN(amount)) {
          clpAmountInput.value = formatter.format(amount);
        }
      });

      async function fetchRates() {
        try {
          const res = await fetch(`https://v6.exchangerate-api.com/v6/${apiKey}/latest/CLP`);
          const data = await res.json();

          if (data.result === "success") {
            rates = data.conversion_rates;
            const date = new Date();
            updateTime.textContent = "Última actualización: " + date.toLocaleString("es-CL");
          } else {
            console.error("Error al obtener tasas:", data);
          }
        } catch (err) {
          console.error("Error de red:", err);
        }
      }

      fetchRates();
    </script>
  </body>
</html>
